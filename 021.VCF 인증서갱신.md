Certificate Management in VCF 영상 및 기타 블로그 정리

기본적으로 SDDC manager가 VCF 구성요소에대한 인증서를 가지고있음.
(vCenter, NSX, SDDC, LCM)
*참고: ESXi host의 인증서는 VMCA가 관리, VCF Cert Management와 통합되어있는것이 아님.
![[Pasted image 20240718115703.png]]

VCF 구성시 외부 CA를 사용하지 않는 이상 Self-signed 인증서를 사용

SDDC Manager는 Self-signed된 인증서를 교체함에 있어 두가지 선택지를 제공
-External Microsoft CA
-Internal OpenSSL CA



VCF 인증서 만료일자 정보
왼쪽 인벤토리 -> Workload Domains -> 도메인 선택 -> Security 탭(이전엔 Certificates였던 것으로 추정)
![[Pasted image 20240718120020.png]]![[Pasted image 20240718120030.png]]



자동화 4.2.1버전
우린 sddc매니저랑 센터인증서 함께 해야함

vcf sddc백업
워크로드 스냅샷
왼쪽 시큐어리티-> CA설정해놓기(해당 CN은 이따 CSR할때 동일하게, 청주는 CN으로 되어있음)
인증서 정보는 백업(인벤토리 - 서머리 - 클릭해보면 나옴)

df -h에서 인증서 저장된곳 확인
vcenter 5480백업(MGMT,WLD)
매니지먼트 워크로드 센터 VM스냅샷

Generate CSR
CN은 이름 기존과 맞춰줘야함(청주는 CA로 되어있음)
인증서 갱신시 적어가는 기본값
해당과정에서 오류발생, 띄어쓰기가 문제? 띄어쓰기는 아닌것같음.. CN을 맞춰줘야함

sddc manager 서비스 리스타트
https://my-cloudy-world.com/2020/02/06/install-signed-certificates-on-each-component-managed-by-sddc-manager-part-5/
리스타트하라는 메시지가 나올때마다 하면 됨

이후 generate signed certificate
-> install certificate

하고나서 sddc manager 보면 fail 빨간메시지가 막 보임
->워크로드 들어갔더니 csr을 다시 만들어줘야할것같은 화면이 나오는데 기다렸더니 센터랑 연동이 되었음.
청주에서 할때는 빨간것없이 빙글빙글돌다 그냥 잘됐음.

인증서 갱신 후 갱신되었는지 확인하고(해당 과정이 꽤 오래걸림, 하나당 20-30분), 백업인증서를 지워줘야할것으로 추정.

워크로드 진행 중 gen csr에서 다시 같은 
에러가 발생(CN을 맞췄는데도)
재부팅하고 기다리면 되는듯

하고나서 스냅샷제거
백업인증서 제거 후 veeam, vrops, vrli, vrA 연동
5432 작업