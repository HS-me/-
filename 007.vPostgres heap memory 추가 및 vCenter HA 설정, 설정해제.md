vpostgres는 센터에서 관리하는 서비스
해당 서비스를 건드리면 vcenter ha가 발동할 수 있음
그래서 vcenter ha를 해제하고 진행

0. 작업대상 접속(센터에 접속)
1. vcenter ha구성상태 스크린샷해놓고 해제
2. 센터vm 스냅샷 생성
메모리 포함 체크 해제
이름 및 설명 입력
3. ssh접속(센터VM)
heap memory 사이즈 변경
cloudvm-ram-size -C 4000 vmware-vpostgres
service-control --stop vmware-vpostgres
service-control --start vmware-vpostgres
(해당 과정에서 ha발동가능성생김, 그래서 꺼줌)

4. 센터에서 vcenter ha 재설정
4-1. ha 구성정보 확인
4-2. vcenter 구성 - vcenter ha - vcenter ha 설정
4-3. 리소스 설정
능동노드 - vcenter ha 네트워크 설정
수동노드, 감시노드도 이전에 해놓은대로 설정

*vCenter HA를 새로 설정할 경우 설정 시 설정하려는 IP에다가 ping을 쳐줘서 확인
vCenter HA는 mgmt 대역으로 태우면 안되고 별도의 대역에 태워야 한다. 그 대역은 고객사측에서 어디다 태울지 알려줘야한다.
vCenter HA 네트워크는 vCenter VM끼리 하트비트를 주고받는 네트워크. vCenter HA 네트워크는 관리 네트워크과 다른 서브넷에 위치해야하는 것이 vCenter HA 구성하는 조건임.
vCenter HA용 네트워크 대역에 존재하는 네트워크 IP는 DNS에 등록할 필요 없음. 



5. 센터VM에 ssh접속
5-1. shell
5-2. embedded db 백업
cd /etc/vmware-vpx/
cp -p embedded_db.cfg embedded_db_bak.cfg
5-3. pg.hba.conf 백업 / 원격 접속 허용 옵션 추가
cd /storage/db/vpostgres/pg.hba(?)
cp -p pg.hba.conf pg.hba_back.conf <-잘못적힌듯
vi pg_hba.conf 후 host all all 0.0.0.0/0 trust 라인 추가

5-4. postgresql.conf 백업, 설정추가
cp -p postgresql.conf postgresql_bak.conf
listen_address='*' <-라인 추가

5-5. vpostgres sql 서비스 리스타트
service-control -list
service-control --restart vmware-vpostgres

5-6. iptable 설정(5432포트 오픈)
iptable -I INPUT 1 -p tcp --dport 5432 -j ACCEPT
iptable --list-rules
/usr/sbin/iptables-save

규현대리가 보내준 워드파일 참조
