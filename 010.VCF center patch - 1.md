1. 백업계정 chage -l backup 만료일자 확인 명령어
2. chage -N 9999 backup([VCF- Precheck fails while checking the backup user password validity. – vConnect-IT (wordpress.com)](https://vconnectit.wordpress.com/2022/03/21/vcf-precheck-fails-while-checking-the-backup-user-password-validity/))
3. 만료기간 그냥 늘려도 된다는 블로그.됨
4. 업데이트 프리체크 sddc매니저에서 확인
5. lcm 매니페스트 파일 사전에 업로드(파일 받아와야함)
6. 집파일 풀어주고.. /opt/vmware/vcf/lcm (문서의 1.2.33)
7. 권한 주는데, chown -R root:root lcm-tools-prod  (문서의 1.2.33)
8. chmod -R 755 lcm-tools-prod  (문서의 1.2.33)
9. 라이프사이클 되는지 확인
10. 프리체크 한번더
11. 센터패치시 drs는 fully
12. 인프라백업계정 비밀번호 infra/infra1234
13. vcf affinity rule
14. 작업 전 root 세션, vcf 세션, 비밀번호 기간 재설정 준비 필요
15. 센터 업데이트 갈길때 root로 진행함(엑셀 두번째 시트 - VCF ASYNC Patch)
16. lcm->bundle management에서 제대로 업로드 됐는지 확인 (문서의 1.2.33 아래의 스크린샷)
17. sddc manager를 W먼저 업데이트하고 센터패치 진행(4.4.1.0에선 안되고 4.4.1.1에서 Async가 가능하기 때문)
18. 작업 간 tali -f lcm-debug.log 등 lcm관련 로그 확인 (operationmanager.log, lcm-log) 
19. vcf authentication 오류발생, KB 참조(sddcmanager UI is failing launch, 연결KB도 참고 사항으로서 확인)
20. 트러블슈팅시 root로 -> root로 진행해야할것, sddc manager로 진행해야할 것 잘 확인
21. postgres 에서 exit역할 \q(역슬래시 q)
22. 19번 ㄸ작업 실행 중 root와 vcf계정 토큰이 W만료되었다고함.(Authenticaton token is no longer valid 오류, 관련 KB 참조), 근데 sddc manager 페이지 들어가면 멀쩡히 작동함. 왜그랬지? 이거 확인
23. 업데이트 과정에서 타임아웃 뜸. (VCF Upgrade 1.3 모니터링에 적힌 로그 확인)
24. 루트계정으로 (passwd vcf)패스워드 변경함. root도 변경.(passwd) <- 자세히 기억안나는데 이게 계정 비밀번호 만료를 9999로 설정해놔서 발생한 것으로 기억함. 이 문서의 27번
25. Finish 때리고, sddc manager에서 인벤토리, 워크로드 도메인, 리트라이 업데이트갈김
26. 진행됐던 과정은 중간 스킵이 되고 그 이후 내용부터 진행됨
27. (모든 계정들 9999로 설정 박아놓은애들이 영향을 주는것으로 추정)-> chage -l root 완료기간 설정하지말고 원래 (90일 혹은 180일)설정대로
28. sddcmanager 업데이트 완료, 아래부터 센터 업데이트 진행
29. 문서에서 권한주는 내용 수정 필요, aptool 경로와 async 경로 모두 755로. 로그내용에 나와있음
30. 27번 진행과정에서 sddcmanager sso 비밀번호를 넣으라는데, runtime error가 떴으나 일시적인 오류(비번 틀린듯).  원인은 명령어 띄어쓰기 잘못넣음. 파란색 인포가 쭉 나오면서 업데이트 진행됨.
31. 이 다음부터 워크로드 진행했던것같음. 화장실다녀와서 중간 과정 못봄
32. 패치파일 업로드중에선 sddcmanager ui에서 error가 많이 보임.
33. 패치파일 업로드되면 버전이 1.1.1.1로 보이는데 아래에 버전 확인하면 됨.
34. 패치파일 업로드과정이 엑셀에서 어디에 해당하는지 확인필요. 이해안됨
35. 프리체크 확인하고, 센터 인벤토리 워크로드도메인 view status로 상태확인
36. 어싱크로 받아서 진행하는것은 문제가 발생함. 수동으로 u3r을 올려서 진행해야함. 로그는 vmon으로 확인. 해당 증상은 스테이징 하다가 성공, 근데 스테이징 풀어버리며 실패함.
37. applmgmt.log 확인
38. this patch support version:none이라는 로그가 나오며 iso를 빼버림
39. /etc/applemgmt/appliance/software_update_state.conf에 업데이트 펜딩표시
40. /storage/seat 해당환경에서 볼수있는것들 확인
41. vcenter vm iso를 클라이언트로 만져주고, 5480에서도 클라이언트 iso로 만져준다.
42. 갑자기 되는 상황. 로그를 확인하는데, 아까 떴던 로그는 또떠있었음. 왜지????(문제 분석 필요)
43. sddc manager log 뜨는법 dell KB에 있음.
44. 워크로드 센터 패치중 프리체크 단계에서 fail(view upgrade status에서 나옴), internal server error 어쩌구저쩌구
45. 그냥 리트하니까 다시됨.. 인줄 알는데 kb가 있다고함
46. 스테이징단계에서 5480 또 똑같은거로 오류 뜸
47. 5480에서 업데이트, 설정, 인증서 확인 체크 해제 후 뭔가를 다시 돌렸는데..
48. 했더니 스테이징은 넘어감, install에서 fail
49. KB320702(This is applicable only for the source vCenter which is restored/powered on after an upgrade failure, The issue is caused post the appliance has recovered from failed update and the update state is "INSTALL_IN_PROGRESS" in "/etc/applmgmt/appliance/software_update_state.conf", as in the example below:

{
    "operation_id": "/storage/core/software-update/stage_install_operation",
    "latest_query_time": "2019-02-13T14:53:00Z",
    "state": "INSTALL_IN_PROGRESS",
    "version": "6.7.0.21000"

위 증상 발생, kb대로 진행하고 패치 다시 되기시작함.
https://knowledge.broadcom.com/external/article/320702/accessing-the-vami-returns-error-update.html



while 명령어 확인
watch cat software_update_state.conf 명령어로 실시간 확인
권한 설정잘 됐는지 ls -lrt
tail -f 

특정 상황(어떤 상황이었는지 다시 설명 들어보자)에서 어싱크로 업로드한 패치파일이 사라지는 이슈가 있었음. 그러니까 이걸 다른 장소에 카피해놓고 패치를 진행하는게 좋아보임.

일단의 최종 목표
4.4.1.0 -> 4.4.1.1 -> center patch 7.0u3r


센터 패치 중 lcm.log

![[Pasted image 20240808170404.png]]


일단 참고kb 추가
[vCenter update task fails on VCF 4.5 or 5.0 with error: Could not convert field “task” of structure ‘com.vmware.appliance.update.into’ (broadcom.com)](https://knowledge.broadcom.com/external/article?legacyId=91064)
ISO관련