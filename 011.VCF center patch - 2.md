참고사항 - 매스페스트 파일, 마커파일, 번들파일, 어싱크패치 브이엠 안에 있음


---------------------------------------

오프라인 번들 다운로드용 프로그램/오프라인 번들 다운로드 후 경로에 복사/에스디디씨에 업로드

1. ‘오프라인 번들 다운로드용 프로그램인 lcm-tool-prod.tar.gz을 에스디디씨 매니저에 업로드(winscp 사용, /home/vcf에 풀어놓는데 국룰인데 장수석님은 다른곳으로 던짐, 문제는tar.gz가 아니라 zip파일이라 문제, unzip으로 진행해도 노상관) -> 압축을 풀고 lcm-bundle-transfer-util을 사용하여 매니페스트 파일을 받는것. 
2. 매니페스트 파일은 sddc manager ui에서 release version 을 보기 위함. 이게없으면 진행이 안됨.
4. mkdir /opt/vmware/vcf/lcm/lcm-tools 경로 생성 (vcf접속 후 root)
5. 해당 경로에 tar-xvzf /home/vcf/lcm-tools-prod.tar.gz -C /opt/vmware/vcf/lcm/lcm-tools로 풀어줌
6. lcmManifestv1.json 파일은 위치가 크게 상관은 없으나 /opt/vmware/vcf/lcm/lcm-tool/bin에 위치시키는게 매뉴얼이고, /opt/vmware/vcf/lcm/lcm-tool/bin에서 ./lcm-bundle-transfer-util --update --sourceManifestDirectory /nfs/vmware/vcf/nfs-mount/bundle/depot/local/ --sddcMgrFqdn mgmt-sddc.hynix.com --sddcMgrUser administrator@vsphere.local를 날리는 것(1.2.1.1). 이를 통해 매니페스트 파일이 업데이트가 된다. 
 
9. lcm-tools에 권한 주기
cd /opt/vmware/vcf/lcm/
chown vcf_lcm:vcf -R lcm-tools
chmod 750 -R lcm-tools
5. 오프라인 번들 다운로드용 프로그램을 받았으니 오프라인 번들을 받아줘야함
./lcm-bundle/transfer-util --download --depotUser ~~~~~~~~~~ /vcf-bundle/ -p 4.4.1.0
->이 번들은 안받아질 가능성 매우높음. bundle-58347,58348 확인 이게 sddc manager 4.4.1.1 번들이었음.(드리프트+패치). bundle은 depot/local/bundle로 가야하고, 그 외엔 스크린샷 대로 나와야함.
vRealize는 안하니까 N


->특정 번들 번호가 뭔지는 lcm으로만 확인가능
독스에서 bundle list관련 문서 있음

* tar xvzf한 오프라인 번들 다운로드용 프로그램의 버전 확인은 /opt/vmware/vcf/lcm/lcm-tools/bin예서 ./lcm-bundle-transfer-util -v로 버전확인)
6. cd /home/vcf로 이동 후 asyncpatchtool 경로에 권한 부여(문서2.3)
chmod -R 755 asyncPatchTool
chown -R vcf:vcf asyncPatchTool

7. 번들 리스팅
리스팅은 문서 2.1
다운로드 과정에서 뭐 이것저것 묻는데 뭐물어보는지는 검색(문서 2.2)

8. 번들 다운로드 전 경로 생성 및 권한부여
mkdir /nfs/vmware/vcf/nfs-mount/apToolBundles
chmod -R 755 apToolBundles/
chown -R vcf:vcf apToolBundles/

9. 번들 다운로드
를 해야하나 어싱크를 내부에서 못돌리니 2.3정이 있는것. 어싱크 통해 받아야하는 패치파일도 있나 확인해야함
-> 어싱크파일.zip을 내 pc에서 받은 후 unzip
./vcf-async-patch-tool --listAsyncPatch --depotUser goodmit@goodmit.co.kr --productType VCENTER -sku VCF
위 명령어로 패치파일들을(모든 번들을) 받고, 
mkdir /nfs/vmware/vcf/nfs-mount/apToolBundles/ 해서 생성된 해당 경로로 모두 넘겨.


10. 다운로드 후 업로드 - 문서 2.3,2.4참조
11.이후 과정은 내꺼 옵시디언과 문서 참조


업로드 과정에서 나오는 비밀번호 요구사항은
SSH password는 vcf
SSO는 administrator
root user는 root



*프리체크 돌렸을때 호스트에 뜨는 써드파티 vib 무시 가능*



1. /nfs/vmware/vcf/nfs-mount/download/upgrade_tools/sddc는 lcm을 돌렸을 때 생성된 놈들
-> bundle, deltafiledownload, deltafiledownload.md5, index.v3, manifest, tmp가 존재함

2. nfs/vmware/vcf/nfs-mount/download/upgrade_tools/test
여기엔 bundle, compatibilitymetadata, index.offline, index.v3, inputspecs, lcmManifest.json, lcmManifests, manifests, tmp 파일 존재 -> async 돌리면 생성되는것들

nfs/vmware/vcf/nfs-mount/download/upgrade_tools/test/bundles
내에 21기가의 bundle들이 존재
이게 테스트때 들었던 어싱크를 돌리면 'bundle들이 다받아진다' 내용으로 보임. 

aA

1. 체크리스트
sddc manager 업로드할때 vcf-async-patch-tool 있는곳에서 업로드를 해야하는가?
왜냐하면 lcm-tools 가 있는곳에서 업로드했었기때문...
만약 맞다면 vcf-async-patch-tool가 어디있는지 체크좀..


/opt/vmware/vcf/lcm/lcm-tools/bin <- 여기 위치였음
어싱크 업로드 위치 /home/vcf/asyncPatchTool/bin임(스크린샷에)
아마 패치파일들은 aptoolbundles에 위치시켰던것으로 기억함

어싱크패치툴 어디있었는지 확인
vc u3r 패치파일 bundle 120545임
왼쪽탭 라이프사이클에 번들 올라간거 확인가능
(번들 매니지먼트에)
aptoolbundles에 있는 모든파일을(번들뿐만 아니라 다)다른 경로에다가 복사해놔야함.
/nfs/vmware/vcf/nfs-mount/aptoolbundles/manifests도 백업..어쨌든 aptoolbundle 전부 백업할거니까 ㅇㅋ
번들 업로드 과정에서 잘못됐을때 업로드한 파일이 없어지는 증상때문에 하는것.

패치중 article 320702 오류 발생
kb로 조치해야할 수도 있음.



센터 패치파일 업로드 잘 될때 

![[Pasted image 20240808160828.png]]멍청하게 세션관리 안하다가 끊어짐
세션관리 안하면 올라가긴하는데 sddc에서 안보였음(사내 테스트 기준)

![[Pasted image 20240808164339.png]]