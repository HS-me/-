heartbeat
1. vSAN 구성 시 HA는 무조건 비활성화, vSAN 구성 후 HA를 활성화시킨다.
2. vSAN 구성 후 HA를 구성하면 HA heartbeat는 Management network가 아니라 vSAN network 통해서 수행된다.

Disk group
각 호스트들은 적어도 하나의 디스크그룹을 가지며 최대 5개의 그룹까지 가능.
각 디스크그룹은 하나의 캐시와 1~7개의 capacity device를 가짐
하이브리드의 경우 캐시디바이스는 무조건 플래시여야함.

하이브리드에선 캐시가 read cache 70%, write buffer 30%
올플래시에서는 100% write buffer, read cache 역할은 capacity에서도 가능
 -> 쓰기작업 효율성 향상

Write buffer는 데이터를 쓰기 작업에 대해 효율적으로 처리하기 위해 사용됩니다. 많은 경우에 쓰기 작업은 작은 크기의 데이터 덩어리로 수행됩니다. Write buffer는 이러한 작은 데이터를 수집하여 하나의 큰 블록으로 쓰기 작업을 수행하므로 쓰기 작업의 효율을 향상시킴

Read cache는 하드 디스크에서 데이터를 읽어야 할 때, 데이터를 먼저 캐시에 로드하고 이후 요청이 있을 때 캐시에서 읽어오게 됩니다.

[참고]
쓰기 캐시는 데이터를 일시적으로 저장하여 빠른 응답을 가능하게 하고, 그 후에 일괄적으로 디스크나 다른 영구 저장소에 쓰게 됩니다.

일반적으로, 컴퓨터 시스템은 많은 작은 쓰기 작업보다는 큰 덩어리의 쓰기 작업을 처리하는 것이 효율적입니다. 하지만, 사용자나 프로그램이 작은 단위로 데이터륾 쓰기를 요청할 수 있습니다. 이 때 쓰기 캐시는 이러한 작은 쓰기 작업들을 버퍼에 저장하고 나중에 한꺼번에 처리함으로써 효율적으로 데이터를 쓸 수 있도록 합니다.



On-Disk format이란?
"on-disk format"은 데이터가 실제 디스크에 저장되는 방식과 형식

Upgrading ondisk and object format
[Upgrading On-Disk and Object Formats in vSAN | VMware](https://core.vmware.com/blog/upgrading-disk-and-object-formats-vsan)





vSAN stretched cluster

policy 관련 정보
[vSAN Storage Policies inside out - Part 1 - Virtualization and Cloud Computing Concepts (vconceptions.com)](https://vconceptions.com/vsan-storage-policies-inside-out-part1/)

[VMs which are not stretched in a stretched cluster, which policy to use? | Yellow Bricks (yellow-bricks.com)](https://www.yellow-bricks.com/2020/12/14/vms-which-are-not-stretched-in-a-stretched-cluster-which-policy-to-use/)


stretched cluster일때

PFTT = Primary level of FTT = '사이트 장애'라고 보면 쉬움. stretched cluster 구성에서는 당연히 PFTT는 항상 최대 1이 된다.
SFTT = Secondary level of FTT = 사이트 전체가 아니라 각 사이트 내에서 FTT가 몇인지를 나타냄.




vSAN object 유형
[Understanding component placements and sizing in vSAN (virtuallysensei.com)](https://virtuallysensei.com/understanding-vsan-component-placement-sizing/)

The VMDK would be the object, and each of the stripes would be a component of that object. -> vSAN 용어 기준으로 오브젝트가 컴포넌트의 상위개념. stripe width에 따라 나눠지는 오브젝트의 일부분들이 컴포넌트인 것.
## Types of Objects seen in a vSAN environment

A VM can have five different types of objects on a vSAN datastore as follows, keeping in mind that each VM may have multiples of some of these objects associated with it:

- #### VM home or “namespace directory”
    
- #### A swap object (if the VM is powered on)
    
- #### Virtual disks/VMDKs
    
- #### Delta disks (each an object) created for snapshots
    
- #### Snapshot memory (each an object) optionally created for snapshots




CLOM - LSOM 어쩌고저쩌고 정보
[[VMware] vSAN Architecture Components (tistory.com)](https://smallrich.tistory.com/65)



[slack space]
vSAN 데이터스토어에서 운영 및 재구축을 위해 남겨두어야 할 공간의 양(스토리지 정책등이 변화해서 rearrangements가 필요할 때 사용되는 공간)
일반적으로 30%
[Why does a vSAN cluster need slack space? (elasticsky.de)](https://www.elasticsky.de/en/2019/11/why-does-a-vsan-cluster-need-slack-space/)
왜 필요한지 예시를 들어놓음.


[Stripe Width]
데이터가 레이드 어레이에 분산되어 저장될 때 한 번에 처리되는 데이터의 블록 또는 세트의 크기
예를 들어, Stripe Width가 128KB로 설정되었다면, 각각의 128KB 데이터 덩어리가 레이드 어레이의 다른 드라이브에 번갈아 가며 저장될 것
파일 "example_file.txt"이 총 512KB 크기를 가지고 있다고 가정해봅시다. Stripe Width가 128KB인 경우, 이 파일은 다음과 같이 레이드 어레이의 드라이브에 분산될 수 있습니다:

- A 드라이브: 128KB (첫 번째 데이터 덩어리)
- B 드라이브: 128KB (두 번째 데이터 덩어리)
- C 드라이브: 128KB (세 번째 데이터 덩어리)
- D 드라이브: 128KB (네 번째 데이터 덩어리)

-> vSAN 환경에서 stripe width 정책을 구성하면 성능 저하 발생 가능.

관련 개념

[Understanding component placements and sizing in vSAN (virtuallysensei.com)](https://virtuallysensei.com/understanding-vsan-component-placement-sizing/)
[An Insight into vSAN-Striping (elasticsky.de)](https://www.elasticsky.de/en/2022/04/an-insight-into-vsan-striping/)
[Stripe Width Storage Policy Improvements vSAN 7 U1 (vmware.com)](https://blogs.vmware.com/virtualblocks/2021/01/21/stripe-width-improvements-in-vsan-7-u1/)


[On-disk format이란?]
vSAN 클러스터 내의 기본 물리적 스토리지 디바이스에 데이터가 저장되는 구조를 나타냄.
vSAN에서 스토리지 작업을 관리하고 최적화할 수 있는 다양한 데이터 구조와 메타데이터가 포함됩니다. 데이터 무결성, 내결함성 및 효율적인 스토리지 작업을 유지하는 데 필수적인 사항.



[vSAN 7 U1 Component Placement & Transient Capacity- virtually Sensei](https://virtuallysensei.com/vsan-7-u1-component-placement/)
[굿모닝아이텍(주) 엔지니어그룹 - 굿모닝아이텍(주) (agit.io)](https://goodmit.agit.io/g/300015130/wall)




[vSAN 캐시 사이징 관련]

캐시사이즈 관련 이야기
[vSAN 캐시 사이징 가이드의 진실 :: 스토리지 성능 이야기 (tistory.com)](https://performance.tistory.com/42)



vSAN 클러스터 환경을 구성 할 때, vSphere HA 기능은 반드시 비활성화(Disabled) 되어 있어야 함. (권장 방식 = vSAN 서비스 활성화 후 vSphere HA 기능 활성화)


HA 설정 이후 각 상황별 케이스
![[Pasted image 20230921093432.png]]


Isolation address 추가 설정방법
[Configure VMware vSphere 7 High Availability advanced options – 4sysops](https://4sysops.com/archives/configure-vmware-vsphere-7-high-availability-advanced-options/)

HA 설정 edit에서 advanced option으로 설정 가능.

das.isolationaddress0,1,2,3...
0이면 기본게이트웨이
1이면 기본 및 추가주소 하나