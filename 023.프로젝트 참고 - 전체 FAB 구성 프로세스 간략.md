(프젝 기준으로 어떻게 설정할건지 전부 결정, 이건 내가 잘 모름)

vdi-호스트,센터 간 방화벽 설정 먼저 완료
호스트 물리적구성 완료
(스토리지 디바이스 연결확인은 디바이스 다시검색)
하나 호스트 골라서 센터 설치

1. 
센터설치하면 가장 먼저 라이센스 및 비밀번호 만료 설정
사전 설정대로 구성됐는지 확인(서류대로 설정)
데이터센터 추가
클러스터 추가
호스트 추가(동일한 자격증명 사용)
데이터스토어 이름
디바이스 물리으로 추가된것 확인(스토리지) - 스토리지 패스 확인은 특정 디바이스 눌러서 연결된 경로 확인(연결및다즁경로지정)
새 데이터스토어를 추가-네이밍 룰 맞춰서-추가시안붙는것으면 스토리지 재검색(위 체크안하고)
데이터스토어 vmfs 만들어주고
bmc 정보(IP등) 알아보는건 esxcli hardware ipmi bmc get(6.5부터 됨)

root 만료 무한 설정은 5480페이지에서
vsphere.local 만료 무한 설정은 vcenter->관리->SSO->구성->로컬계정->암호정책->편집

스토리지 패스가 제대로 안보이는 경우가 있다.(이중화가 안된것 등). 이런 경우 스토리지매니저한테 WWN 알려주고 패스가 안보인다 말해야함

라이프사이클매니저 업데이트 안뜨게 설정해주고
데이터스토어 클러스터 옵션들 지정해서 설정, 해당값들은 역시 사전에 다 지정되어있음. 

분산스위치 만들때 기본구성 어쩌고 체크하고 페일백안함, 기본포트그룹 안만들도록 설정함
https://www.nakivo.com/blog/vmware-distributed-switch-configuration/
https://www.altaro.com/vmware/vsphere-distributed-switch-guide/

표준스위치에서 분산스위치로 네트워크 마이그레이션하는법
네트워크 마이그레이션시 업링크 선택을 스탠바이하는 업링크부터 보내고, 그다음 vmk를 포트할당으로 넘기고, VM넘기고(vm을 다른 네트워크로 넘기기), 액티브를 넘긴다. 그리고나서 표준스위치 제거
https://www.ubackup.com/enterprise-backup/vmware-migrate-standard-vswitch-to-distributed.amp.html

https://youtu.be/6zwViwZGyYU?si=AKyfolOQnzgZb5nA 요거야무짐 네트워크마이그레이션


GAD(히타치에서 쓰는 용어)에 의해서 ATS OFF, clustered vmdk 관련 개념정리

-esxcli storage vmfs lockmode list
ats / ats-scsi, ats를 꺼줘야할것같은데?

SCSi reservation 관련
https://neokobo.blogspot.com/2015/07/scsi-reservations-atomic-test-and-set.html?m=1


vlan tagging관련
https://kb.vmware.com/s/article/1003806
가상스위치 포트그룹 VLAN ID를 0으로 지정해야 할 때)
패킷의 VLAN Tagging이 물리적 스위치에서 일어날 때 [ESXi 호스트 네트워크 어댑터가 물리적 스위치의 Access 포트가 연결되어 있음]

가상스위치 포트그룹 VLAN ID를 특정해야 할 때)
VLAN Tagging이 ESXi 호스트에서 빠져나가기 전, 가상스위치에서 일어날 때 [ESXi 호스트 네트워크 어댑터가 물리적 스위치의 Trunk 포트와 연결되어 있어야 함]
-쉽게 말해서 상단에서 트렁크 걸렸으면 직접브이랜설정


호스트 처음 설치했을때 CVE 2018 3646 경고 kb55636 -> kb55806으로 이어짐
보안취약점 - L1캐시에있는 vm 데이터들을 가져갈 수있게됨. 호스트의 advance setting - hyperthredingmitigation true 먹이고 호스트 재부팅하면 알림 무시가 가능

근본적으로 취약점 방지를 하려면 advisorscheduler 옵션을 조정해야하는데, 하이퍼바이저 레벨에서 DB, 윈도우,리눅스 등등에 성능저하가 발생할 수 있다.
https://byounghee.me/2019/04/30/performance-of-vsphere-6-7-scheduling-options/


스토리지 설정값 관련
iops값이 더 큰 기본값이 안정성이 더 좋은것
1로 바꾸는것이 부하가 더 큼(라운드로빈 기준 1마다 바뀌니까)
근데 스토리지 성능이 좋아지면서 1로해도 부하를 견딜만큼 괜찮아짐. 예전엔 ㄴㄴ였는데. 그래서 더 높은 성능 위해 상대적으로 안정적인 기본값 말고 1로 커스텀하는것.

하드웨어 전원은(구성->하드웨어->개요) 고성능으로 바꿔줌

호스트프로파일
프로파일 추출전에 ntp, 고급시스템설정(ssh경고 알람 끄거나 하이퍼쓰레딩 관련 알람끄는 등) 설정을 먼저 먹여줌

ssh 알람 끄는법 
[VMware Warning: SSH or ESXi Shell for the host has been enabled - LabCrasher](https://labcrasher.com/2021/08/18/vmware-warning-ssh-or-esxi-shell-for-the-host-has-been-enabled/)
**UserVars.SuppressShellWarning**
요거 0에서 1변경

hyperthreading 알람 끄는법 
1. From the vSphere Client, select the ESXi host and go to *Manage > System > Advanced System Settings**.-
2. Click **Edit**.
3. Select the **UserVars.SuppressHyperthreadWarning** value and configure it to **0**.


추출-프로필복제-원본꺼를 프로필편집(edit host profile) - 필요한것만 체크- 규정준수검사 -재부팅은 웬만해서 체크 ㄴㄴ - 프로필이랑 맞지않기때문에 규정준수검사 빨간것 뜸 - customize host - 네트워크 대역 직접 빨간것 뜬곳에 눌러줌 - 스토리지 명령어는 직접 날려줌
https://ma-you-ing.tistory.com/m/76
https://smallrich.tistory.com/m/21
https://www.nakivo.com/blog/how-to-create-and-set-up-vmware-vsphere-host-profiles/
호스트 프로파일 각종 설정은 구성-advanced setting에서 가능

사전검사 시 vmotion등의 프라이빗 대역은 직접 입력. 오류발생할 수 있음. 메시지보고 로그 보면 됨
요번에 구성할때 물리장비의 pci슬롯을 잘못 인식하는 경우가 한번 있었음.(예를들어 nic가 4,7로 쌍이되어야하는데 물리장비 오류로 7번 포트를 8번으로 인식)




가상화율 - 가상화VM에서 사용하는양/찐 장비 스펙 
물리 cpu 계산: 기본스펙x2소켓x2하이퍼스레딩
메모리역시 똑같이 계산




mscs같은 경우 대역을 2개를 줘야함.
메인 1번은 mgmt, 2번은 vcha처럼 대역를 따로줘서 하트비트하도록 프라이빗대역을 줘야한다.

scsi3은 7버전부터 clustered vmdk사용 가능, 오라클꺼는 scsi2를 사용, clustered vmdk 사용 가능
리눅스는 clustered vmdk 활성화하지않아도 된다

스위치 vlan 설정 관련 kb
(위에서 어떤거 구성하면 0으로 구성하고)
https://kb.vmware.com/s/article/1003806

vrli id password admin/VMware1!
청주는 인프라에 옵스랑 li 마스터VM들을 가지고있음. 
IP 위에 클러스터IP개념이 있어서 마스터,마스터레플리카,마스터데이터(옵스)로 보내주는 로그들을 알아서 분배.(마스터가 죽으면 그다음으로 보내고 등)

로그인사이트의경우 li vm 클러스터 구성을 먼저 하고 그다음 로그전달->대상추가해서 보낼곳 지정

옵스의경우 용도별로 마스터/레플리카/데이터 지정해서 보낸다. 

vcf엔 li 마스터가 자체적으로 있다. fc1만 바라보고있네

원래대로면 옵스 로그인사이트랑 호스트 센터 버전 호환성 체크하고

li설치시 domain search path는 뒤에 cjad.hynix부분

센터 계정
(Li, ops 주의사항)

골든이미지의 경우 기본적으로는 OS만 깔린다.
OS와 어플리케이션이 뭐가 깔릴지는 사전에 다 정함. JDK, TIBCO, Oracle Client 등

Li도 host파일에 넣읍시다

cbeqa센터의 li는 vcfli로 연동
전체프로세스: 수집할 센터를 등록, 수집되는지 확인하고, 로그 전달할 마스터를 등록해서 전달받을 곳에서 로그가 들어오는지 확인.

로그관리->로그전달방식으로 청주는 되어있음(건너뛰기), 라이센스 넣어야 로그전달 등록가능.
라이센스는 다른센터꺼 넣어서 쓰네
Ingestion api설정하고 테스트, 받는쪽에서 해당 메시지 받았는지 확인


새배포를 진행하는것같은데, smtp없어서 이메일이런건 생략
SSL 저장하고 계속
끝나면 

li를 통합->vsphere에 등록(수집할 센터를 등록하는것)cbeqa에 있는애니까 cbeqa vcenter를 등록 ->로그전달할 마스터쪽으로 전달위치 등록

분산스위치에 등록 후 테스트 vm에 nic달아서 대역별 테스트

esxi 설치후 체크리스트
dns ntp power evc ha drs localdatastorename license storageipos(제조사별)

로컬데이터스토어 교체시 점검
vobd log(+센터 내 디바이스 경로)
구성->하드웨어 상태

다음주 해야할것
커널달고
스토리지 확인하고
가상머신 하나 만들어서 대역별 핑테스트하고
HA 걸고

센터에 붙여놨을때 nic가 10G, 1G인지 확인

