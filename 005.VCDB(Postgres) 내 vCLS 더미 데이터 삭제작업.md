# 작업 이유
1. vSphere HA 구성 실패 혹은 구성에 성공하더라도 vCLS가 자동생성이 안됨.
2. vCenter에서 vCLS의 더미데이터를 vCLS가 있다고 판단해 vCLS가 생성이 안되는것으로 판단되었음

# 작업프로시저

1. Stop the vpxd service
service-control --stop vpxd

2. Connect to VCDB:
/opt/vmware/vpostgres/current/bin/psql -d VCDB -U postgres

3. Identify the VM ID in the vCenter database with this command:
 select * from vpx_entity where name like '%<vm name>%';  
 Example Output: 
VCDB=# select * from vpx_entity where name like '%vcsa%';
id  |   name    | type_id | parent_id
------+----------+---------+-----------
1562 | vcsa |       0 |      1002
1563 | vcsa(orphaned) |       0 |      1002
Note the ID of the VM to be deleted from the above output.
-> 테이블에 나온 orphaned된 VM ID 기록(1563)


4. orphaned된 VM 수동 삭제
delete from  VPX_COMPUTE_RESOURCE_DAS_VM where VM_ID=1563

delete from  VPX_COMPUTE_RESOURCE_DRS_VM where VM_ID=1563

delete from  VPX_COMPUTE_RESOURCE_ORC_VM where VM_ID=1563

delete from  VPX_VM_SGXINFO where VM_ID=1563

delete from  VPX_GUEST_DISK where VM_ID=1563

delete from  VPX_VM_VIRTUAL_DEVICE where ID=1563

delete from  VPX_VM_DS_SPACE where VM_ID=1563

delete from  VPX_NON_ORM_VM_CONFIG_INFO where ID=1563

delete from  VPX_NORM_VM_FLE_FILE_INFO where VM_ID=1563

delete from  VPX_VDEVICE_BACKING_REL where VM_ID=1563

delete from  VPX_VIRTUAL_DISK_IOFILTERS where VM_ID=1563

delete from  VPX_VM_STATIC_OVERHEAD_MAP where VM_ID=1563

delete from  VPX_VM_TEXT where VM_ID=1563

delete from  VPX_VM where ID=1563

delete from  VPX_ENTITY where ID=1563

   
6. Start the vpxd service on the vCenter Server to pick up the database changes.
service-control --start vpxd
